#!/bin/bash
# (c) 2004 Martin Man <mman@swac.cz>

set -e

. @MYDATA@/functions

print_banner
parse_commandline $* ||\
    usage "product.conf {-t||-b branch} {-b new_branch}"

if [ $MODE != "trunkbranch" ] && [ $MODE != "branchbranch" ]
then
    echo "ERROR: $0 is supposed to work with {-t -b} or {-b -b} only"
    exit 1
fi

do_process_config || exit 1

do_prepare_variables_for_packaging

echo "Product: $PRODUCT"
echo "Distributions: $DISTROS"
wait_for_user_break

for DISTRO in $DISTROS; do

    echo ""
    echo "Packaging $PRODUCT for distribution: $DISTRO"

    do_prepare_variables_for_packaging

    echo ""
    echo "Packaging: $pkg_src_url"
    echo "Branching to: $pkg_dst_url"
    wait_for_user_break

    svn_copy "$pkg_src_url" "$pkg_dst_url" "$PRODUCT $DISTRO branch $ARG2 generated by $0" || exit 1

done

exit 0

# vim: set ft=sh et ts=4 sw=4:
